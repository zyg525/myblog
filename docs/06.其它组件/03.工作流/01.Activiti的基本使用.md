---
title: Activiti的基本使用
date: 2024-05-16 22:41:38
permalink: /pages/ac5bb2/
categories:
  - 其它组件
  - 工作流
tags:
  - 
author: 
  name: zyg
  link: https://github.com/zyg525
---
## 一、简介

　　工作流(Workflow)，就是通过计算机对业务流程自动化执行管理。它主要解决的是“使在多个参与者之间按照某种预定义的规则自动进行传递文档、信息或任务的过程，从而实现某个预期的业务目标，或者促使此目标的实现”。

　　Alfresco软件在2010年5月17日宣布Activiti业务流程管理（BPM）开源项目的正式启动，其首席架构师由业务流程管理BPM的专家 Tom Baeyens担任，Tom Baeyens就是原来jbpm的架构师，而jbpm是一个非常有名的工作流引擎，当然activiti也是一个工作流引擎。

　　Activiti是一个工作流引擎， activiti可以将业务系统中复杂的业务流程抽取出来，使用专门的建模语言BPMN2.0进行定义，业务流程按照预先定义的流程进行执行，实现了系统的流程由activiti进行管理，减少业务系统由于流程变更进行系统升级改造的工作量，从而提高系统的健壮性，同时也减少了系统开发维护成本。

　　官方网站：https://www.activiti.org/

## 二、SpringBoot集成Activiti实现流程审批

　　1、添加依赖

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.zyg</groupId>
    <artifactId>learnActivti</artifactId>
    <version>1.0-SNAPSHOT</version>

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.7.5</version>
    </parent>

    <properties>
        <maven.compiler.source>8</maven.compiler.source>
        <maven.compiler.target>8</maven.compiler.target>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    </properties>

    <dependencies>
        <!-- SpringBoot起步依赖 -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <!-- 数据库驱动依赖 -->
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
        </dependency>
        <!-- mybatis起步依赖 -->
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
            <version>2.1.0</version>
        </dependency>
        <!-- 测试依赖 -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>


        <dependency>
            <groupId>commons-dbcp</groupId>
            <artifactId>commons-dbcp</artifactId>
            <version>1.4</version>
        </dependency>

        <!-- activiti相关依赖 -->
        <dependency>
            <groupId>org.activiti</groupId>
            <artifactId>activiti-bpmn-converter</artifactId>
            <version>5.18.0</version>
        </dependency>
        <dependency>
            <groupId>org.activiti</groupId>
            <artifactId>activiti-bpmn-model</artifactId>
            <version>5.18.0</version>
        </dependency>
        <dependency>
            <groupId>org.activiti</groupId>
            <artifactId>activiti-image-generator</artifactId>
            <version>5.18.0</version>
        </dependency>
        <dependency>
            <groupId>org.activiti</groupId>
            <artifactId>activiti-process-validation</artifactId>
            <version>5.18.0</version>
        </dependency>
        <dependency>
            <groupId>org.activiti</groupId>
            <artifactId>activiti-spring</artifactId>
            <version>5.18.0</version>
        </dependency>
    </dependencies>

</project>
```

　　2、编写`application.yml`文件和配置类`ActivitiConfig.java`

```yml
server:
  port: 8080

spring:
  datasource:
    url: jdbc:mysql://192.168.220.128:3306/activiti?useUnicode=true&characterEncoding=UTF-8&nullCatalogMeansCurrent=true
    username: root
    password: root
```

```java
@Configuration
public class ActivitiConfig {
    @Autowired
    HikariDataSource dataSource;

    @Bean
    public StandaloneInMemProcessEngineConfiguration processEngineConfiguration() {
        StandaloneInMemProcessEngineConfiguration configuration = new StandaloneInMemProcessEngineConfiguration();
        configuration.setDataSource(dataSource);
        configuration.setDatabaseSchemaUpdate("true");
        return configuration;
    }
}
```

　　3、创建`activiti`数据库并初始化，初始化后会生成24张和工作流相关的表

```sql
create database `activiti`;
```

```java
@Autowired
ProcessEngineConfiguration configuration;

/**
 * 初始化数据库
 */
@Test
public void initDataBase() {
    ProcessEngine engine = configuration.buildProcessEngine();
}
```

　　4、安装IDEA插件`Activiti BPMN visualizer`，在`resources`目录下右键创建流程图文件`leave.bpmn20.xml`，然后打开文件，右键点击`View BPMN Diagarm`，就可以画流程图了，这里设置流程图的id是`leave`，并给每个审批节点分配好人员，比如第一个节点由张三审批。

　　5、部署流程实例

```java
/**
 * 部署流程
 */
@Test
public void deployProcess() {
    ProcessEngine engine = configuration.buildProcessEngine();
    RepositoryService repositoryService = engine.getRepositoryService();
    Deployment deployment = repositoryService.createDeployment()
            .addClasspathResource("leave.bpmn20.xml")
            .name("请假申请流程")
            .deploy();

    System.out.println("流程部署id：" + deployment.getId());
    System.out.println("流程部署name" + deployment.getName());
}
```

　　6、启动流程

```java
/**
 * 启动流程
 */
@Test
public void startProcess() {
    ProcessEngine engine = configuration.buildProcessEngine();
    RuntimeService runtimeService = engine.getRuntimeService();
    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey("leave");

    System.out.println("流程定义id：" + processInstance.getProcessDefinitionId());
    System.out.println("流程实例id：" + processInstance.getProcessInstanceId());
    System.out.println("当前活动id：" + processInstance.getActivityId());

}
```

　　7、查询并办理流程任务

```java
/**
 * 查询并办理流程任务
 */
@Test
public void completeAuto() {
    ProcessEngine engine = configuration.buildProcessEngine();
    TaskService taskService = engine.getTaskService();
    Task autoTask = taskService.createTaskQuery()
            .processDefinitionKey("leave")
            .taskAssignee("张三")
            .singleResult();
    taskService.complete(autoTask.getId());
}
```

　

参考链接：

1、https://github.com/andanyoung/activitiDemo

2、https://xuzhongcn.github.io/activiti/activiti.html#header-n3

3、https://gitee.com/shenzhanwang/RuoYi-activiti