---
title: Spring Security结合JWT管理用户权限
date: 2024-05-18 19:50:24
permalink: /pages/994ca0/
categories:
  - 其它组件
  - 加密与安全
tags:
  - 
author: 
  name: zyg
  link: https://github.com/zyg525
---
## 一、简介

### Spring Security简介

　　Spring Security是一个功能强大且高度可定制的身份验证和访问控制框架。提供了完善的**认证机制**和方法级的**授权功能**。是一款非常优秀的权限管理框架。它的核心是一组过滤器链，不同的功能经由不同的过滤器。

### JWT简介

　　**JWT(JSON Web Token)**，是一种用于通信双方之间传递安全信息的简洁的、URL安全的表述性声明规范。一个JWT实际上就是一个字符串，它由三部分组成，头部、载荷与签名，用`.`分隔：

```
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6Inp5ZyJ9.8TYNlySs_KOU-vC0R4ajL08c5TthGQa3CVakeyKA6ug
```

　　在https://jwt.io/可以解析出它的内容：

```json
HEADER:ALGORITHM & TOKEN TYPE
{
  "typ": "JWT",
  "alg": "HS256"
}

PAYLOAD:DATA
{
  "username": "zyg"
}

VERIFY SIGNATURE
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  your-256-bit-secret
) secret base64 encoded
```

### 基本原理

　　权限管理分为两部分，一是认证，解决你是谁的问题，具体表现为注册和登录，二是授权，解决你能干什么的问题，具体表现为你登录后有哪些权限。

　　对于注册，基本思路是先使用不可逆加密算法对用户密码进行加密，并存放在数据库中，如果想提高安全性，可以给每个密码加上随机生成的salt值，并将salt值一并存放到数据库中。

　　对于登录，基本思路是先从数据库中查询用户名，如果用户名存在，再使用同样的算法对登录密码进行加密，如果两个密码相同，则登录成功，同时根据用户名生成一个token，返回给客户端。

　　对于授权，基本思路是用户请求中携带着上一次登录时返回的token，服务器对token进行解析，确认是本人访问，再从数据库中查询出该用户拥有的角色，这样用户就可以访问该角色有权访问的路径了。

## 二、实战

　　项目的结构如下图所示：

![learnJWT项目结构](/myblog/img/java/learnJWT项目结构.png)

　　**使用密码登录的过程**：`LoginController`(接收请求) -> `AuthenticationManager`(调用MyJwtProvider) -> `MyJwtProvider`(调用UserDetailsService) -> `UserDetailsService`(调用MyUserServiceImpl) -> `MyUserServiceImpl`(查询数据库)。

　　**使用token免密访问并管理权限的过程**：`MyJwtFilter`(接收请求、解析校验token、调用UserDetailsService) -> `UserDetailsService` -> `UserDetailsService`(调用MyUserServiceImpl) -> `MyUserServiceImpl`(查询数据库) -> `LoginController`(根据查询到的角色信息校验权限)。

　

　　源码地址：https://github.com/zyg525/learnJWT

　

参考资料：

1、https://shusheng007.top/2023/02/15/springsecurity/

2、https://www.cnblogs.com/little-monster-lhq/p/17250186.html