(window.webpackJsonp=window.webpackJsonp||[]).push([[164],{508:function(s,a,t){"use strict";t.r(a);var e=t(4),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("学习不走弯路，"),a("a",{attrs:{href:"#%E5%85%AC%E4%BC%97%E5%8F%B7"}},[s._v("关注公众号")]),s._v(" 回复「学习路线」，获取mall项目专属学习路线！")]),s._v(" "),a("h1",{attrs:{id:"mall-swarm微服务项目在k8s下的实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mall-swarm微服务项目在k8s下的实践"}},[s._v("#")]),s._v(" mall-swarm微服务项目在K8S下的实践！")]),s._v(" "),a("blockquote",[a("p",[s._v("由于K8S目前实在是太火了，之前一直说要给mall项目出个K8S部署方案，这次它来啦！在更新完K8S系列教程后，是时候来波实践了，拿"),a("code",[s._v("mall-swarm")]),s._v("项目来实践真的是刚刚好。如果你有在Docker下部署该项目的经历，而且已经学习了我的K8S系列教程的话，相信你能够轻松上手！")])]),s._v(" "),a("h2",{attrs:{id:"服务器规划"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器规划"}},[s._v("#")]),s._v(" 服务器规划")]),s._v(" "),a("blockquote",[a("p",[s._v("我们先来说下服务器规划吧，之前一直使用的是单机部署所有服务，这次我们使用两台服务器来部署。")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("基础服务器（192.168.3.101）：用于部署"),a("code",[s._v("mall-swarm")]),s._v("的依赖服务，包括MySql、Redis、Elasticsearch等与应用无关的服务，采用Docker方式来部署。")])]),s._v(" "),a("li",[a("p",[s._v("应用服务器（192.168.3.102）：用于部署"),a("code",[s._v("mall-swarm")]),s._v("的应用服务，包括mall-admin、mall-portal、mall-search等应用服务，采用K8S方式来部署。")])])]),s._v(" "),a("h2",{attrs:{id:"镜像打包及推送"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像打包及推送"}},[s._v("#")]),s._v(" 镜像打包及推送")]),s._v(" "),a("blockquote",[a("p",[s._v("为了方便部署，我们把"),a("code",[s._v("mall-swarm")]),s._v("的所有应用镜像都上传到Docker Hub上去。")])]),s._v(" "),a("ul",[a("li",[s._v("首先修改项目根目录下的"),a("code",[s._v("pom.xml")]),s._v("文件；")])]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--改为你自己的Docker服务远程访问地址--\x3e")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("docker.host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("http://192.168.3.101:2375"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("docker.host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("使用Maven插件将所有镜像打包到Linux服务器上，直接使用根项目下的"),a("code",[s._v("package")]),s._v("命令即可；")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/mall_swarm_deploy_k8s_01.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("修改所有镜像标签名称，修改本地镜像标签名称为远程镜像标签名称；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag mall/mall-gateway:1.0-SNAPSHOT macrodocker/mall-gateway:1.0-SNAPSHOT\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag mall/mall-auth:1.0-SNAPSHOT macrodocker/mall-auth:1.0-SNAPSHOT\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag mall/mall-monitor:1.0-SNAPSHOT macrodocker/mall-monitor:1.0-SNAPSHOT\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag mall/mall-admin:1.0-SNAPSHOT macrodocker/mall-admin:1.0-SNAPSHOT\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag mall/mall-portal:1.0-SNAPSHOT macrodocker/mall-portal:1.0-SNAPSHOT\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag mall/mall-search:1.0-SNAPSHOT macrodocker/mall-search:1.0-SNAPSHOT\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ul",[a("li",[s._v("修改完成后查询"),a("code",[s._v("macrodocker")]),s._v("相关镜像显示如下，"),a("code",[s._v("macrodocker")]),s._v("为我们在Docker Hub上的仓库地址；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@local-linux ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker images |grep macrodocker")]),s._v("\nmacrodocker/mall-auth      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("-SNAPSHOT        72df5f91f2d7        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" minutes ago       699MB\nmacrodocker/mall-gateway   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("-SNAPSHOT        4055dfc1e601        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" minutes ago       708MB\nmacrodocker/mall-monitor   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("-SNAPSHOT        492d9bb4375c        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" minutes ago       696MB\nmacrodocker/mall-portal    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("-SNAPSHOT        8dd79675f40c        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" minutes ago      719MB\nmacrodocker/mall-search    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("-SNAPSHOT        f0d0d80c590f        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" minutes ago      734MB\nmacrodocker/mall-admin     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("-SNAPSHOT        15737ce903a9        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" minutes ago      715MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("ul",[a("li",[s._v("之后推送镜像到Docker Hub，如果你不想自己推送镜像，可以使用我已经上传好到镜像。")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录Docker Hub")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" login\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 推送到远程仓库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push macrodocker/mall-gateway:1.0-SNAPSHOT\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push macrodocker/mall-auth:1.0-SNAPSHOT\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push macrodocker/mall-monitor:1.0-SNAPSHOT\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push macrodocker/mall-admin:1.0-SNAPSHOT\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push macrodocker/mall-portal:1.0-SNAPSHOT\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push macrodocker/mall-search:1.0-SNAPSHOT\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"基础服务器部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础服务器部署"}},[s._v("#")]),s._v(" 基础服务器部署")]),s._v(" "),a("blockquote",[a("p",[s._v("我们依然使用Docker来部署依赖服务，"),a("code",[s._v("mall-swarm")]),s._v("运行需要的依赖服务如下，使用Docker Compose脚本安装更方便，Docker Compose使用请参考："),a("a",{attrs:{href:"https://mp.weixin.qq.com/s/iMl9bJ4SxUsNHBbiS5VUcw",target:"_blank",rel:"noopener noreferrer"}},[s._v("《使用Docker Compose部署SpringBoot应用》"),a("OutboundLink")],1),s._v(" 。")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("组件")]),s._v(" "),a("th",[s._v("版本号")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("Mysql")]),s._v(" "),a("td",[s._v("5.7")])]),s._v(" "),a("tr",[a("td",[s._v("Redis")]),s._v(" "),a("td",[s._v("5.0")])]),s._v(" "),a("tr",[a("td",[s._v("MongoDb")]),s._v(" "),a("td",[s._v("4.3.5")])]),s._v(" "),a("tr",[a("td",[s._v("RabbitMq")]),s._v(" "),a("td",[s._v("3.7.15")])]),s._v(" "),a("tr",[a("td",[s._v("Nginx")]),s._v(" "),a("td",[s._v("1.10")])]),s._v(" "),a("tr",[a("td",[s._v("Elasticsearch")]),s._v(" "),a("td",[s._v("7.6.2")])]),s._v(" "),a("tr",[a("td",[s._v("Logstash")]),s._v(" "),a("td",[s._v("7.6.2")])]),s._v(" "),a("tr",[a("td",[s._v("Kibana")]),s._v(" "),a("td",[s._v("7.6.2")])]),s._v(" "),a("tr",[a("td",[s._v("Nacos")]),s._v(" "),a("td",[s._v("1.3.0")])])])]),s._v(" "),a("ul",[a("li",[s._v("本项目已经提供好了Docker Compose脚本，直接执行如下命令即可，脚本地址：https://github.com/macrozheng/mall-swarm/blob/master/document/docker/docker-compose-env.yml")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" docker-compose-env.yml up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("某些系统组件无法启动问题，具体参考："),a("a",{attrs:{href:"https://mp.weixin.qq.com/s/JYkvdub9DP5P9ULX4mehUw",target:"_blank",rel:"noopener noreferrer"}},[s._v("《mall在Linux环境下的部署（基于Docker Compose）》"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[s._v("部署完成后，查看Docker中运行的服务显示如下。")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@local-linux ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker ps")]),s._v("\nCONTAINER ID        IMAGE                        COMMAND                  CREATED             STATUS              PORTS                                                                                        NAMES\nfef5695319d1        nacos/nacos-server:1.3.0     "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bin/docker-startup.…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" months ago        Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" hours          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:8848-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v("/tcp                                                                       nacos-registry\ne7ec37fcafda        elasticsearch:7.6.2          "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/bin/dock…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" months ago        Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" hours          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:9200-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:9300-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9300")]),s._v("/tcp                                               elasticsearch\n427f0176c426        mongo:4.2.5                  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-entrypoint.s…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" months ago        Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" hours          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:27017-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27017")]),s._v("/tcp                                                                     mongo\n5618ed50942a        redis:5                      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-entrypoint.s…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" months ago        Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" hours          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:6379-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("/tcp                                                                       redis\n1744f412c6f4        rabbitmq:3.7.15-management   "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-entrypoint.s…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" months ago        Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" hours          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4369")]),s._v("/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5671")]),s._v("/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:5672-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5672")]),s._v("/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15671")]),s._v("/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25672")]),s._v("/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:15672-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15672")]),s._v("/tcp   rabbitmq\n6b26f63dfad6        mysql:5.7                    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-entrypoint.s…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" months ago        Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" hours          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:3306-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33060")]),s._v("/tcp                                                            mysql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"应用服务器部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用服务器部署"}},[s._v("#")]),s._v(" 应用服务器部署")]),s._v(" "),a("blockquote",[a("p",[s._v("我们将把"),a("code",[s._v("mall-swarm")]),s._v("中所有应用服务都部署到K8S上，使用Rancher来进行可视化管理。")])]),s._v(" "),a("h3",{attrs:{id:"安装rancher"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装rancher"}},[s._v("#")]),s._v(" 安装Rancher")]),s._v(" "),a("ul",[a("li",[s._v("首先需要安装Rancher，先下载Rancher的Docker镜像；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull rancher/rancher:v2.5-head\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("下载完成后在Docker容器中运行Rancher服务；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(":443 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" rancher "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("unless-stopped "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" rancher/rancher:v2.5-head\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("Rancher启动成功后，通过如下地址就可以访问它的主页了：http://192.168.3.102")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/mall_swarm_deploy_k8s_02.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"修改nacos配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改nacos配置"}},[s._v("#")]),s._v(" 修改Nacos配置")]),s._v(" "),a("blockquote",[a("p",[s._v("将项目"),a("code",[s._v("config")]),s._v("目录下的所有配置都添加到Nacos中，由于应用服务都部署到了K8S中，所以需要修改相关配置。")])]),s._v(" "),a("ul",[a("li",[s._v("将配置信息添加到Nacos中后显示信息如下，Nacos访问地址：http://192.168.3.101:8848/nacos/index.html")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/mall_swarm_deploy_k8s_03.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("修改"),a("code",[s._v("mall-admin-prod.yaml")]),s._v("配置，修改MySql和Redis连接地址即可，之前是通过"),a("code",[s._v("--link")]),s._v("的形式访问的，这次需要改为IP进行访问；")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("datasource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" jdbc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//192.168.3.101"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("3306/mall"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("useUnicode=true"),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("&characterEncoding=utf-8&serverTimezone=Asia/Shanghai")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.3.101 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis服务器地址")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("database")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis数据库索引（默认为0）")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis服务器连接端口")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不设置密码")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("ul",[a("li",[s._v("修改"),a("code",[s._v("mall-gateway-prod.yaml")]),s._v("配置，修改Redis连接地址及JWT的publicKey访问地址即可（当在K8S中创建服务后，可以通过服务名进行访问）；")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.3.101 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis服务器地址")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("database")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis数据库索引（默认为0）")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis服务器连接端口")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不设置密码")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("security")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("oauth2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resourceserver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jwt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jwk-set-uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://mall-gateway-service:8201/mall-auth/rsa/publicKey'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("ul",[a("li",[s._v("修改"),a("code",[s._v("mall-portal-prod.yaml")]),s._v("配置，修改MySql、MongoDb、Redis、RabbitMq连接地址即可；")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("datasource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" jdbc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//192.168.3.101"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("3306/mall"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("useUnicode=true"),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("&characterEncoding=utf-8&serverTimezone=Asia/Shanghai")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mongodb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.3.101\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27017")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("database")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mall"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("port\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.3.101 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis服务器地址")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("database")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis数据库索引（默认为0）")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis服务器连接端口")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不设置密码")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rabbitmq")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.3.101\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5672")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("virtual-host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /mall\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mall\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mall\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("publisher-confirms")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果对异步消息需要回调必须设置为true")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("ul",[a("li",[s._v("修改"),a("code",[s._v("mall-search-prod.yaml")]),s._v("配置，修改MySql、Elasticsearch连接地址即可。")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("datasource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" jdbc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//192.168.3.101"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("3306/mall"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("useUnicode=true"),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("&characterEncoding=utf-8&serverTimezone=Asia/Shanghai")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("elasticsearch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uris")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//192.168.3.101"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"使用rancher部署应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用rancher部署应用"}},[s._v("#")]),s._v(" 使用Rancher部署应用")]),s._v(" "),a("blockquote",[a("p",[s._v("当使用Rancher创建Deployment时，如果镜像下载过慢会出现超时，可以进入到Rancher容器中手动进行下载。")])]),s._v(" "),a("ul",[a("li",[s._v("首先进入Rancher容器内部；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" exex "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" rancher /bin/bash\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("通过"),a("code",[s._v("crictl")]),s._v("命令下载应用镜像，下载过程有点慢而且没有进度条，需要耐心等待；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("k3s crictl pull macrodocker/mall-gateway:1.0-SNAPSHOT\nk3s crictl pull macrodocker/mall-auth:1.0-SNAPSHOT\nk3s crictl pull macrodocker/mall-monitor:1.0-SNAPSHOT\nk3s crictl pull macrodocker/mall-admin:1.0-SNAPSHOT\nk3s crictl pull macrodocker/mall-portal:1.0-SNAPSHOT\nk3s crictl pull macrodocker/mall-search:1.0-SNAPSHOT\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ul",[a("li",[s._v("下载完成后查看镜像显示内容如下；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("root@ae85f823208f:/var/lib/rancher"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# k3s crictl images |grep macrodocker")]),s._v("\ndocker.io/macrodocker/mall-admin     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("-SNAPSHOT        15737ce903a94       308MB\ndocker.io/macrodocker/mall-auth      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("-SNAPSHOT        72df5f91f2d74       293MB\ndocker.io/macrodocker/mall-gateway   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("-SNAPSHOT        4055dfc1e6016       301MB\ndocker.io/macrodocker/mall-monitor   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("-SNAPSHOT        492d9bb4375c6       291MB\ndocker.io/macrodocker/mall-portal    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("-SNAPSHOT        8dd79675f40c1       312MB\ndocker.io/macrodocker/mall-search    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("-SNAPSHOT        f0d0d80c590f1       325MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("ul",[a("li",[s._v("镜像都下载完成后，我们就可以使用Rancher来可视化创建Deployment了，这里以"),a("code",[s._v("YAML")]),s._v("的方式来创建；")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/mall_swarm_deploy_k8s_04.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("直接将项目"),a("code",[s._v("k8s")]),s._v("文件夹中的"),a("code",[s._v("mall-admin-deployment.yaml")]),s._v("文件内容复制下即可；")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/mall_swarm_deploy_k8s_05.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("之后再使用"),a("code",[s._v("mall-admin-service.yaml")]),s._v("文件创建Service；")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/mall_swarm_deploy_k8s_06.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("这里仅以"),a("code",[s._v("mall-admin")]),s._v("应用为例创建Deployment和Service，其他应用创建过程基本相同，脚本均在项目的k8s文件夹中。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/mall_swarm_deploy_k8s_07.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"效果展示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#效果展示"}},[s._v("#")]),s._v(" 效果展示")]),s._v(" "),a("blockquote",[a("p",[s._v("使用Rancher部署完所有应用服务之后，让我们来看看效果。")])]),s._v(" "),a("ul",[a("li",[s._v("首先查看所有创建的Deployment；")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/mall_swarm_deploy_k8s_08.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("查看所有创建的Service；")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/mall_swarm_deploy_k8s_09.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("如果你想查看应用的启动日志，在Pod列表查看即可；")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/mall_swarm_deploy_k8s_10.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("由于应用服务被部署在Rancher容器内部，无法直接访问，我们可以使用Nginx反向代理来访问，Nginx服务运行在"),a("code",[s._v("2080")]),s._v("端口上；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2080")]),s._v(":2080 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /mydata/nginx/html:/usr/share/nginx/html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /mydata/nginx/logs:/var/log/nginx  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /mydata/nginx/conf:/etc/nginx "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" nginx:1.10\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[s._v("接下来需要获得Rancher容器运行的IP地址，使用如下命令即可；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@linux-local ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker inspect rancher |grep IPAddress")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SecondaryIPAddresses"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPAddress"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.17.0.2"')]),s._v(",\n                    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPAddress"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.17.0.2"')]),s._v(",\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("创建完Nginx容器后，添加配置文件"),a("code",[s._v("api.conf")]),s._v("，将"),a("code",[s._v("api.macrozheng.com")]),s._v("域名的访问反向代理到K8S中的"),a("code",[s._v("mall-gateway-service")]),s._v("服务上去；")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server {\n    listen       2080;\n    server_name  api.macrozheng.com; #修改域名\n\n    location / {\n        proxy_set_header Host $host:$server_port;\n        proxy_pass   http://172.17.0.2:30201; #修改为代理服务地址\n        index  index.html index.htm;\n    }\n\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("ul",[a("li",[s._v("再修改访问Linux服务器的本机host文件，添加如下记录；")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("192.168.3.102 api.macrozheng.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("其实也可以不用Nginx来进行反向代理，创建容器的时候将"),a("code",[s._v("mall-gateway-service")]),s._v("的端口映射出来即可；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(":443 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8201")]),s._v(":30201 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" rancher "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("unless-stopped "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" rancher/rancher:v2.5-head\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("通过Nginx即可访问"),a("code",[s._v("mall-swarm")]),s._v("的接口文档，访问地址：http://api.macrozheng.com:2080/doc.html")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/mall_swarm_deploy_k8s_11.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("p",[s._v("通过把"),a("code",[s._v("mall-swarm")]),s._v("项目部署到K8S上，我们可以发现K8S也没有想象中到那么难，K8S中的很多东西都是和Docker相通的！当我们听到消息称某个新技术要取代旧技术了，往往会困惑我们学的那些旧技术是不是过时了，没用了？其实我们大可不必担心，往往新技术都是在旧技术的基础上产生的，而且那些会旧技术的人会更容易掌握新技术！")]),s._v(" "),a("h2",{attrs:{id:"k8s系列教程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k8s系列教程"}},[s._v("#")]),s._v(" K8S系列教程")]),s._v(" "),a("blockquote",[a("p",[s._v("再次推荐一波我的K8S系列教程，K8S实战看这些就对了！")])]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/N-9xVPYO_VVL5JZu5UPbtQ",target:"_blank",rel:"noopener noreferrer"}},[s._v("K8S太火了！花10分钟玩转它不香么？"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/dwrxKr4ONfzCLn01QbkpQg",target:"_blank",rel:"noopener noreferrer"}},[s._v("自从上了K8S，项目更新都不带停机的！"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/RXAQtsNXUS2kiSCMFDxKqA",target:"_blank",rel:"noopener noreferrer"}},[s._v("我把SpringBoot应用部署到了K8S上，怎么感觉用起来像Docker！"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/NOkaYGz9ZT3bsG1J7yXVRA",target:"_blank",rel:"noopener noreferrer"}},[s._v("再见命令行！K8S傻瓜式安装，图形化管理真香！"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/a7w2qvDg8c2BEQU7A1NqaA",target:"_blank",rel:"noopener noreferrer"}},[s._v("看看人家那开源项目文档写的，那叫一个友好！"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/iDG7Wzq9DQHLFPtnqokOxQ",target:"_blank",rel:"noopener noreferrer"}},[s._v("据说只有高端机器才配运行K8S，网友：1G内存的渣渣跑起来了！"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/jBP7E7DL5vJ0zp5UnSFNBg",target:"_blank",rel:"noopener noreferrer"}},[s._v("再见 Docker ！5分钟转型 containerd !"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"项目源码地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目源码地址"}},[s._v("#")]),s._v(" 项目源码地址")]),s._v(" "),a("p",[s._v("https://github.com/macrozheng/mall-swarm")]),s._v(" "),a("h2",{attrs:{id:"公众号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#公众号"}},[s._v("#")]),s._v(" 公众号")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://macro-oss.oss-cn-shenzhen.aliyuncs.com/mall/banner/qrcode_for_macrozheng_258.jpg",alt:"公众号图片"}})])])}),[],!1,null,null,null);a.default=n.exports}}]);