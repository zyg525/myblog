(window.webpackJsonp=window.webpackJsonp||[]).push([[207],{551:function(s,a,n){"use strict";n.r(a);var t=n(4),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("学习不走弯路，"),a("a",{attrs:{href:"#%E5%85%AC%E4%BC%97%E5%8F%B7"}},[s._v("关注公众号")]),s._v(" 回复「学习路线」，获取mall项目专属学习路线！")]),s._v(" "),a("h1",{attrs:{id:"使用jenkins一键打包部署springboot应用-就是这么6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用jenkins一键打包部署springboot应用-就是这么6"}},[s._v("#")]),s._v(" 使用Jenkins一键打包部署SpringBoot应用，就是这么6！")]),s._v(" "),a("blockquote",[a("p",[s._v("任何简单操作的背后，都有一套相当复杂的机制。本文将以SpringBoot应用的在Docker环境下的打包部署为例，详细讲解如何使用Jenkins一键打包部署SpringBoot应用。")])]),s._v(" "),a("h2",{attrs:{id:"jenkins简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins简介"}},[s._v("#")]),s._v(" Jenkins简介")]),s._v(" "),a("p",[s._v("Jenkins是开源CI&CD软件领导者，提供超过1000个插件来支持构建、部署、自动化，满足任何项目的需要。我们可以用Jenkins来构建和部署我们的项目，比如说从我们的代码仓库获取代码，然后将我们的代码打包成可执行的文件，之后通过远程的ssh工具执行脚本来运行我们的项目。")]),s._v(" "),a("h2",{attrs:{id:"jenkins的安装及配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins的安装及配置"}},[s._v("#")]),s._v(" Jenkins的安装及配置")]),s._v(" "),a("h3",{attrs:{id:"docker环境下的安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker环境下的安装"}},[s._v("#")]),s._v(" Docker环境下的安装")]),s._v(" "),a("ul",[a("li",[s._v("下载Jenkins的Docker镜像：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull jenkins/jenkins:lts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("在Docker容器中运行Jenkins：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v(":5000 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" jenkins "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /mydata/jenkins_home:/var/jenkins_home "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" jenkins/jenkins:lts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"jenkins的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins的配置"}},[s._v("#")]),s._v(" Jenkins的配置")]),s._v(" "),a("ul",[a("li",[s._v("运行成功后访问该地址登录Jenkins，第一次登录需要输入管理员密码：http://192.168.6.132:8080/")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_23.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("使用管理员密码进行登录，可以使用以下命令从容器启动日志中获取管理密码：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs jenkins\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("从日志中获取管理员密码：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_24.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("选择安装插件方式，这里我们直接安装推荐的插件：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_25.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("进入插件安装界面，联网等待插件安装：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_26.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("安装完成后，创建管理员账号：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_27.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("进行实例配置，配置Jenkins的URL：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_28.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("点击系统管理->插件管理，进行一些自定义的插件安装：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_14.png",alt:""}})]),s._v(" "),a("ul",[a("li",[a("p",[s._v("确保以下插件被正确安装：")]),s._v(" "),a("ul",[a("li",[s._v("根据角色管理权限的插件：Role-based Authorization Strategy")]),s._v(" "),a("li",[s._v("远程使用ssh的插件：SSH plugin")])])]),s._v(" "),a("li",[a("p",[s._v("通过系统管理->全局工具配置来进行全局工具的配置，比如maven的配置：")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_15.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("新增maven的安装配置：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_16.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("在系统管理->系统配置中添加全局ssh的配置，这样Jenkins使用ssh就可以执行远程的linux脚本了：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_17.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"角色权限管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#角色权限管理"}},[s._v("#")]),s._v(" 角色权限管理")]),s._v(" "),a("blockquote",[a("p",[s._v("我们可以使用Jenkins的角色管理插件来管理Jenkins的用户，比如我们可以给管理员赋予所有权限，运维人员赋予执行任务的相关权限，其他人员只赋予查看权限。")])]),s._v(" "),a("ul",[a("li",[s._v("在系统管理->全局安全配置中启用基于角色的权限管理：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_18.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("进入系统管理->Manage and Assign Roles界面：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_19.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("添加角色与权限的关系：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_20.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("给用户分配角色：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_21.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"打包部署springboot应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包部署springboot应用"}},[s._v("#")]),s._v(" 打包部署SpringBoot应用")]),s._v(" "),a("blockquote",[a("p",[s._v("这里我们使用"),a("code",[s._v("mall-learning")]),s._v("项目中的"),a("code",[s._v("mall-tiny-jenkins")]),s._v("模块代码来演示下如何使Jenkins一键打包部署SpringBoot应用。")])]),s._v(" "),a("h3",{attrs:{id:"将代码上传到git仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将代码上传到git仓库"}},[s._v("#")]),s._v(" 将代码上传到Git仓库")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("首先我们需要安装Gitlab（当然你也可以使用Github或者Gitee），然后将"),a("code",[s._v("mall-tiny-jenkins")]),s._v("中的代码上传到Gitlab中去，Gitlab的使用请参考："),a("a",{attrs:{href:"https://mp.weixin.qq.com/s/6GyYlR9lpVcjgYmHMYLi0w",target:"_blank",rel:"noopener noreferrer"}},[s._v("10分钟搭建自己的Git仓库"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[a("code",[s._v("mall-tiny-jenkins")]),s._v("项目源码地址：https://github.com/macrozheng/mall-learning/tree/master/mall-tiny-jenkins")])]),s._v(" "),a("li",[a("p",[s._v("上传完成后Gitlab中的展示效果如下：")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_01.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("有一点需要"),a("code",[s._v("注意")]),s._v("，要将pom.xml中的dockerHost地址改成你自己的Docker镜像仓库地址：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_22.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"执行脚本准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行脚本准备"}},[s._v("#")]),s._v(" 执行脚本准备")]),s._v(" "),a("ul",[a("li",[s._v("将"),a("code",[s._v("mall-tiny-jenkins.sh")]),s._v("脚本文件上传到"),a("code",[s._v("/mydata/sh")]),s._v("目录下，脚本内容如下：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/usr/bin/env bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app_name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mall-tiny-jenkins'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" stop "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${app_name}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'----stop container----'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${app_name}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'----rm container----'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8088")]),s._v(":8088 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${app_name}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--link")]),s._v(" mysql:db "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /etc/localtime:/etc/localtime "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /mydata/app/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${app_name}")]),s._v("/logs:/var/logs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" mall-tiny/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${app_name}")]),s._v(":1.0-SNAPSHOT\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'----start container----'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("ul",[a("li",[s._v("给.sh脚本添加可执行权限：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x ./mall-tiny-jenkins.sh  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("windows下的.sh脚本上传到linux上使用，需要修改文件格式，否则会因为有特殊格式存在而无法执行：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用vim编辑器来修改")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" mall-tiny-jenkins.sh\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看文件格式，windows上传上来的默认为dos")]),s._v("\n:set ff \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改文件格式为unix")]),s._v("\n:set "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ff")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("unix \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#保存并退出")]),s._v("\n:wq\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("ul",[a("li",[s._v("执行.sh脚本，测试使用，可以不执行：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("./mall-tiny-jenkins.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"在jenkins中创建执行任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在jenkins中创建执行任务"}},[s._v("#")]),s._v(" 在Jenkins中创建执行任务")]),s._v(" "),a("ul",[a("li",[s._v("首先我们需要新建一个任务：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_02.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("设置任务名称后选择构建一个自由风格的软件项目：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_03.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("然后在源码管理中添加我们的git仓库地址：http://192.168.6.132:1080/macrozheng/mall-tiny-jenkins")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_04.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("此时需要添加一个凭据，也就是我们git仓库的账号密码：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_05.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("填写完成后选择该凭据，就可以正常连接git仓库了；")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_06.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("之后我们需要添加一个构建，选择调用顶层maven目标，该构建主要用于把我们的源码打包成Docker镜像并上传到我们的Docker镜像仓库去：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_07.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("选择我们的maven版本，然后设置maven命令和指定pom文件位置：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_08.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("之后添加一个执行远程shell脚本的构建，用于在我们的镜像打包完成后执行启动Docker容器的.sh脚本：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_09.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("需要设置执行的shell命令如下：/mydata/sh/mall-tiny-jenkins.sh")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_10.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("之后点击保存操作，我们的任务就创建完成了，在任务列表中我们可以点击运行来执行该任务；")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_11.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("我们可以通过控制台输出来查看整个任务的执行过程：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_12.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("运行成功后，访问该地址即可查看API文档：http://192.168.6.132:8088/swagger-ui.html")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/jenkins_use_13.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"项目源码地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目源码地址"}},[s._v("#")]),s._v(" 项目源码地址")]),s._v(" "),a("p",[s._v("https://github.com/macrozheng/mall-learning/tree/master/mall-tiny-jenkins")]),s._v(" "),a("h2",{attrs:{id:"公众号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#公众号"}},[s._v("#")]),s._v(" 公众号")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://macro-oss.oss-cn-shenzhen.aliyuncs.com/mall/banner/qrcode_for_macrozheng_258.jpg",alt:"公众号图片"}})])])}),[],!1,null,null,null);a.default=e.exports}}]);