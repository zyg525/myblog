(window.webpackJsonp=window.webpackJsonp||[]).push([[197],{541:function(s,a,t){"use strict";t.r(a);var e=t(4),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("学习不走弯路，"),a("a",{attrs:{href:"#%E5%85%AC%E4%BC%97%E5%8F%B7"}},[s._v("关注公众号")]),s._v(" 回复「学习路线」，获取mall项目专属学习路线！")]),s._v(" "),a("h1",{attrs:{id:"elasticsearch官方已支持sql查询-用起来贼方便"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch官方已支持sql查询-用起来贼方便"}},[s._v("#")]),s._v(" Elasticsearch官方已支持SQL查询，用起来贼方便！")]),s._v(" "),a("blockquote",[a("p",[s._v("平时使用Elasticsearch的时候，偶尔会在Kibana中使用Query DSL来查询数据。每次要用到Query DSL时都基本忘光了，需要重新在回顾一遍，最近发现Elasticsearch已经支持SQL查询了（6.3版本以后），整理了下其用法，希望对大家有所帮助！")])]),s._v(" "),a("h2",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),a("p",[s._v("Elasticsearch SQL是一个X-Pack组件，它允许针对Elasticsearch实时执行类似SQL的查询。无论使用REST接口，命令行还是JDBC，任何客户端都可以使用SQL对Elasticsearch中的数据进行原生搜索和聚合数据。可以将Elasticsearch SQL看作是一种翻译器，它可以将SQL翻译成Query DSL。")]),s._v(" "),a("p",[s._v("Elasticsearch SQL具有如下特性：")]),s._v(" "),a("ul",[a("li",[s._v("原生支持：Elasticsearch SQL是专门为Elasticsearch打造的。")]),s._v(" "),a("li",[s._v("没有额外的零件：无需其他硬件，处理器，运行环境或依赖库即可查询Elasticsearch，Elasticsearch SQL直接在Elasticsearch内部运行。")]),s._v(" "),a("li",[s._v("轻巧高效：Elasticsearch SQL并未抽象化其搜索功能，相反的它拥抱并接受了SQL来实现全文搜索，以简洁的方式实时运行全文搜索。")])]),s._v(" "),a("h2",{attrs:{id:"学前准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#学前准备"}},[s._v("#")]),s._v(" 学前准备")]),s._v(" "),a("p",[s._v("学习之前我们需要先对Elasticsearch有所了解，并安装好Elasticsearch和Kibana，这里安装的是7.6.2版本，具体可以参考"),a("a",{attrs:{href:"https://mp.weixin.qq.com/s/cohWZy_eUOUqbmUxhXzzNA",target:"_blank",rel:"noopener noreferrer"}},[s._v("《Elasticsearch快速入门，掌握这些刚刚好！》"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("p",[s._v("安装完成后在Kibana中导入测试数据，数据地址： https://github.com/macrozheng/mall-learning/blob/master/document/json/accounts.json")]),s._v(" "),a("p",[s._v("直接在Kibana的Dev Tools中运行如下命令即可：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/es_sql_start_01.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"第一个sql查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一个sql查询"}},[s._v("#")]),s._v(" 第一个SQL查询")]),s._v(" "),a("p",[s._v("我们使用SQL来查询下前10条记录，可以通过"),a("code",[s._v("format")]),s._v("参数控制返回结果的格式，txt表示文本格式，看起来更直观点，默认为json格式。")]),s._v(" "),a("p",[s._v("在Kibana的Console中输入如下命令：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('POST /_sql?format=txt\n{\n  "query": "SELECT account_number,address,age,balance FROM account LIMIT 10"\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("查询结果显示如下。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/es_sql_start_02.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"将sql转化为dsl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将sql转化为dsl"}},[s._v("#")]),s._v(" 将SQL转化为DSL")]),s._v(" "),a("p",[s._v("当我们需要使用Query DSL时，也可以先使用SQL来查询，然后通过Translate API转换即可。")]),s._v(" "),a("p",[s._v("例如我们翻译以下查询语句：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('POST /_sql/translate\n{\n  "query": "SELECT account_number,address,age,balance FROM account WHERE age>32 LIMIT 10"\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("最终获取到Query DSL结果如下。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/es_sql_start_03.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"sql和dsl混合使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sql和dsl混合使用"}},[s._v("#")]),s._v(" SQL和DSL混合使用")]),s._v(" "),a("p",[s._v("我们还可以将SQL和Query DSL混合使用，比如使用Query DSL来设置过滤条件。")]),s._v(" "),a("p",[s._v("例如查询age在30-35之间的记录，可以使用如下查询语句：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('POST /_sql?format=txt\n{\n  "query": "SELECT account_number,address,age,balance FROM account",\n      "filter": {\n        "range": {\n            "age": {\n                "gte" : 30,\n                "lte" : 35\n            }\n        }\n    },\n    "fetch_size": 10\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("查询结果展示如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/es_sql_start_04.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"sql和es对应关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sql和es对应关系"}},[s._v("#")]),s._v(" SQL和ES对应关系")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("SQL")]),s._v(" "),a("th",[s._v("ES")]),s._v(" "),a("th",[s._v("描述")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("column")]),s._v(" "),a("td",[s._v("field")]),s._v(" "),a("td",[s._v("数据库中表的字段与ES中的属性对应")])]),s._v(" "),a("tr",[a("td",[s._v("row")]),s._v(" "),a("td",[s._v("document")]),s._v(" "),a("td",[s._v("数据库表中的行记录与ES中的文档对应")])]),s._v(" "),a("tr",[a("td",[s._v("table")]),s._v(" "),a("td",[s._v("index")]),s._v(" "),a("td",[s._v("数据库中的表与ES中的索引对应")])])])]),s._v(" "),a("h2",{attrs:{id:"常用sql操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用sql操作"}},[s._v("#")]),s._v(" 常用SQL操作")]),s._v(" "),a("h3",{attrs:{id:"语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#语法"}},[s._v("#")]),s._v(" 语法")]),s._v(" "),a("p",[s._v("在ES中使用SQL查询的语法与在数据库中使用基本一致，具体格式如下：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" select_expr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" table_name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" condition "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" grouping_element "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("HAVING")]),s._v(" condition"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" expression "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ASC")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LIMIT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" count "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PIVOT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" aggregation_expr "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" alias "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"where"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#where"}},[s._v("#")]),s._v(" WHERE")]),s._v(" "),a("p",[s._v("可以使用"),a("code",[s._v("WHERE")]),s._v("语句设置查询条件，比如查询state字段为VA的记录，查询语句如下。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('POST /_sql?format=txt\n{\n  "query": "SELECT account_number,address,age,balance,state FROM account WHERE state=\'VA\' LIMIT 10 "\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("查询结果展示如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/es_sql_start_05.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"group-by"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#group-by"}},[s._v("#")]),s._v(" GROUP BY")]),s._v(" "),a("p",[s._v("我们可以使用"),a("code",[s._v("GROUP BY")]),s._v("语句对数据进行分组，统计出分组记录数量，最大age和平均balance等信息，查询语句如下。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('POST /_sql?format=txt\n{\n  "query": "SELECT state,COUNT(*),MAX(age),AVG(balance) FROM account GROUP BY state LIMIT 10"\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/mall/es_sql_start_06.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"having"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#having"}},[s._v("#")]),s._v(" HAVING")]),s._v(" "),a("p",[s._v("我们可以使用"),a("code",[s._v("HAVING")]),s._v("语句对分组数据进行二次筛选，比如筛选分组记录数量大于15的信息，查询语句如下。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('POST /_sql?format=txt\n{\n  "query": "SELECT state,COUNT(*),MAX(age),AVG(balance) FROM account GROUP BY state HAVING COUNT(*)>15 LIMIT 10"\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/mall/es_sql_start_07.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"order-by"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#order-by"}},[s._v("#")]),s._v(" ORDER BY")]),s._v(" "),a("p",[s._v("我们可以使用"),a("code",[s._v("ORDER BY")]),s._v("语句对数据进行排序，比如按照balance字段从高到低排序，查询语句如下。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('POST /_sql?format=txt\n{\n  "query": "SELECT account_number,address,age,balance,state FROM account ORDER BY balance DESC LIMIT 10 "\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/mall/es_sql_start_08.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"describe"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#describe"}},[s._v("#")]),s._v(" DESCRIBE")]),s._v(" "),a("p",[s._v("我们可以使用"),a("code",[s._v("DESCRIBE")]),s._v("语句查看表（ES中为索引）中有哪些字段，比如查看account表的字段，查询语句如下。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('POST /_sql?format=txt\n{\n  "query": "DESCRIBE account"\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/mall/es_sql_start_09.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"show-tables"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#show-tables"}},[s._v("#")]),s._v(" SHOW TABLES")]),s._v(" "),a("p",[s._v("我们可以使用"),a("code",[s._v("SHOW TABLES")]),s._v("查看所有的表（ES中为索引）。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('POST /_sql?format=txt\n{\n  "query": "SHOW TABLES"\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/mall/es_sql_start_10.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"支持的函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#支持的函数"}},[s._v("#")]),s._v(" 支持的函数")]),s._v(" "),a("p",[s._v("使用SQL查询ES中的数据，不仅可以使用一些SQL中的函数，还可以使用一些ES中特有的函数。")]),s._v(" "),a("h3",{attrs:{id:"查询支持的函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询支持的函数"}},[s._v("#")]),s._v(" 查询支持的函数")]),s._v(" "),a("p",[s._v("我们可以使用"),a("code",[s._v("SHOW FUNCTIONS")]),s._v("语句查看所有支持的函数，比如搜索所有带有"),a("code",[s._v("DATE")]),s._v("字段的函数可以使用如下语句。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('POST /_sql?format=txt\n{\n  "query": "SHOW FUNCTIONS LIKE \'%DATE%\'"\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/mall/es_sql_start_11.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"全文搜索函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全文搜索函数"}},[s._v("#")]),s._v(" 全文搜索函数")]),s._v(" "),a("p",[s._v("全文搜索函数是ES中特有的，当使用"),a("code",[s._v("MATCH")]),s._v("或"),a("code",[s._v("QUERY")]),s._v("函数时，会启用全文搜索功能，"),a("code",[s._v("SCORE")]),s._v("函数可以用来统计搜索评分。")]),s._v(" "),a("h4",{attrs:{id:"match"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#match"}},[s._v("#")]),s._v(" MATCH()")]),s._v(" "),a("p",[s._v("使用"),a("code",[s._v("MATCH")]),s._v("函数查询address中包含Street的记录。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('POST /_sql?format=txt\n{\n  "query": "SELECT account_number,address,age,balance,SCORE() FROM account WHERE MATCH(address,\'Street\') LIMIT 10"\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/mall/es_sql_start_12.png",alt:""}})]),s._v(" "),a("h4",{attrs:{id:"query"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#query"}},[s._v("#")]),s._v(" QUERY()")]),s._v(" "),a("p",[s._v("使用"),a("code",[s._v("QUERY")]),s._v("函数查询address中包含Street的记录。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('POST /_sql?format=txt\n{\n  "query": "SELECT account_number,address,age,balance,SCORE() FROM account WHERE QUERY(\'address:Street\') LIMIT 10"\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/mall/es_sql_start_13.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"sql-cli"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sql-cli"}},[s._v("#")]),s._v(" SQL CLI")]),s._v(" "),a("p",[s._v("如果你不想使用Kibana来使用ES SQL的话，也可以使用ES自带的SQL CLI来查询，该命令位于ES的bin目录下。")]),s._v(" "),a("p",[s._v("使用如下命令启动SQL CLI：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("elasticsearch-sql-cli http://localhost:9200\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/mall/es_sql_start_14.png",alt:""}})]),s._v(" "),a("p",[s._v("然后直接输入SQL命令即可查询了，注意要加分号。")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" account_number"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("address"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("balance "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" account "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LIMIT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/mall/es_sql_start_15.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"局限性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#局限性"}},[s._v("#")]),s._v(" 局限性")]),s._v(" "),a("p",[s._v("使用SQL查询ES有一定的局限性，没有原生的Query DSL那么强大，对于嵌套属性和某些函数的支持并不怎么好，但是平时用来查询下数据基本够用了。")]),s._v(" "),a("h2",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),a("p",[s._v("官方文档：https://www.elastic.co/guide/en/elasticsearch/reference/7.6/xpack-sql.html")]),s._v(" "),a("h2",{attrs:{id:"公众号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#公众号"}},[s._v("#")]),s._v(" 公众号")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://macro-oss.oss-cn-shenzhen.aliyuncs.com/mall/banner/qrcode_for_macrozheng_258.jpg",alt:"公众号图片"}})])])}),[],!1,null,null,null);a.default=n.exports}}]);