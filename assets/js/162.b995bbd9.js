(window.webpackJsonp=window.webpackJsonp||[]).push([[162],{506:function(a,t,r){"use strict";r.r(t);var s=r(4),e=Object(s.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("p",[a._v("学习不走弯路，"),t("a",{attrs:{href:"#%E5%85%AC%E4%BC%97%E5%8F%B7"}},[a._v("关注公众号")]),a._v(" 回复「学习路线」，获取mall项目专属学习路线！")]),a._v(" "),t("h1",{attrs:{id:"mall-swarm在linux环境下的部署-基于docker容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mall-swarm在linux环境下的部署-基于docker容器"}},[a._v("#")]),a._v(" mall-swarm在Linux环境下的部署（基于Docker容器）")]),a._v(" "),t("blockquote",[t("p",[a._v("本文以"),t("code",[a._v("mall-swarm")]),a._v("项目为例，主要介绍一个微服务架构的电商项目如何在Docker容器下部署，涉及到大量系统组件的部署及多个Spring Cloud微服务应用的部署，基于CentOS7.6。")])]),a._v(" "),t("h2",{attrs:{id:"环境搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境搭建"}},[a._v("#")]),a._v(" 环境搭建")]),a._v(" "),t("h3",{attrs:{id:"基础环境部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基础环境部署"}},[a._v("#")]),a._v(" 基础环境部署")]),a._v(" "),t("blockquote",[t("p",[t("code",[a._v("mall-swarm")]),a._v("运行需要的系统组件如下，使用Docker Compose 批量安装更方便，Docker Compose使用请参考："),t("a",{attrs:{href:"http://www.macrozheng.com/#/reference/docker_compose",target:"_blank",rel:"noopener noreferrer"}},[a._v("使用Docker Compose部署SpringBoot应用"),t("OutboundLink")],1),a._v(" 。")])]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("组件")]),a._v(" "),t("th",[a._v("版本号")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("Mysql")]),a._v(" "),t("td",[a._v("5.7")])]),a._v(" "),t("tr",[t("td",[a._v("Redis")]),a._v(" "),t("td",[a._v("5.0")])]),a._v(" "),t("tr",[t("td",[a._v("MongoDb")]),a._v(" "),t("td",[a._v("4.3.5")])]),a._v(" "),t("tr",[t("td",[a._v("RabbitMq")]),a._v(" "),t("td",[a._v("3.7.15")])]),a._v(" "),t("tr",[t("td",[a._v("Nginx")]),a._v(" "),t("td",[a._v("1.10")])]),a._v(" "),t("tr",[t("td",[a._v("Elasticsearch")]),a._v(" "),t("td",[a._v("7.6.2")])]),a._v(" "),t("tr",[t("td",[a._v("Logstash")]),a._v(" "),t("td",[a._v("7.6.2")])]),a._v(" "),t("tr",[t("td",[a._v("Kibana")]),a._v(" "),t("td",[a._v("7.6.2")])]),a._v(" "),t("tr",[t("td",[a._v("Nacos")]),a._v(" "),t("td",[a._v("1.3.0")])])])]),a._v(" "),t("ul",[t("li",[a._v("本项目已经提供好了Docker Compose脚本，直接执行即可，脚本地址：https://github.com/macrozheng/mall-swarm/blob/master/document/docker/docker-compose-env.yml")])]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" docker-compose-env.yml up "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("ul",[t("li",[t("p",[a._v("某些系统组件无法启动问题，具体参考："),t("a",{attrs:{href:"http://www.macrozheng.com/#/deploy/mall_deploy_docker_compose",target:"_blank",rel:"noopener noreferrer"}},[a._v("mall在Linux环境下的部署（基于Docker Compose）"),t("OutboundLink")],1)])]),a._v(" "),t("li",[t("p",[a._v("由于新增了"),t("code",[a._v("Logstash")]),a._v("组件，需要预先创建好Logstash的配置文件，再安装Logstash的JSON插件，配置文件地址：https://github.com/macrozheng/mall-swarm/tree/master/document/elk/logstash.conf")])])]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建好配置文件目录")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" /mydata/logstash\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 进入容器使用如下命令安装插件")]),a._v("\nlogstash-plugin "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" logstash-codec-json_lines\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("h3",{attrs:{id:"镜像打包上传"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#镜像打包上传"}},[a._v("#")]),a._v(" 镜像打包上传")]),a._v(" "),t("blockquote",[t("p",[a._v("一共6个应用服务需要打包成Docker镜像，具体如何打包可以参考"),t("a",{attrs:{href:"http://www.macrozheng.com/#/reference/docker_maven",target:"_blank",rel:"noopener noreferrer"}},[a._v("使用Maven插件为SpringBoot应用构建Docker镜像"),t("OutboundLink")],1),a._v(" 。需要注意的是如果打包过程中遇到找不到"),t("code",[a._v("mall-common")]),a._v("或"),t("code",[a._v("mall-mbg")]),a._v("模块，需要先按顺序将这些模块install到本地maven仓库再进行打包。")])]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("应用")]),a._v(" "),t("th",[a._v("说明")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("mall-monitor")]),a._v(" "),t("td",[a._v("监控中心")])]),a._v(" "),t("tr",[t("td",[a._v("mall-gateway")]),a._v(" "),t("td",[a._v("微服务网关")])]),a._v(" "),t("tr",[t("td",[a._v("mall-auth")]),a._v(" "),t("td",[a._v("认证中心")])]),a._v(" "),t("tr",[t("td",[a._v("mall-admin")]),a._v(" "),t("td",[a._v("商城后台服务")])]),a._v(" "),t("tr",[t("td",[a._v("mall-portal")]),a._v(" "),t("td",[a._v("商城前台服务")])]),a._v(" "),t("tr",[t("td",[a._v("mall-search")]),a._v(" "),t("td",[a._v("商城搜索服务")])])])]),a._v(" "),t("p",[a._v("镜像打包上传完成后，完整docker仓库镜像示意图：")]),a._v(" "),t("p",[t("img",{attrs:{src:"/img/mall/mall_swarm_run_09.png",alt:""}})]),a._v(" "),t("h2",{attrs:{id:"应用部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#应用部署"}},[a._v("#")]),a._v(" 应用部署")]),a._v(" "),t("h3",{attrs:{id:"在nacos中添加配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在nacos中添加配置文件"}},[a._v("#")]),a._v(" 在Nacos中添加配置文件")]),a._v(" "),t("ul",[t("li",[a._v("由于我们使用Nacos作为配置中心，统一管理配置，所以我们需要将项目"),t("code",[a._v("config")]),a._v("目录下的所有配置都添加到Nacos中，Nacos访问地址：http://192.168.3.101:8848/nacos/")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/img/mall/mall_swarm_run_10.png",alt:""}})]),a._v(" "),t("ul",[t("li",[a._v("注意，配置文件的文件名称需要和Nacos中的"),t("code",[a._v("Data Id")]),a._v("一一对应；")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/img/mall/mall_swarm_run_11.png",alt:""}})]),a._v(" "),t("h3",{attrs:{id:"使用docker-compose批量部署所有应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用docker-compose批量部署所有应用"}},[a._v("#")]),a._v(" 使用Docker Compose批量部署所有应用")]),a._v(" "),t("ul",[t("li",[a._v("直接使用提供好的Docker Compose脚本，启动所有应用即可，脚本地址：https://github.com/macrozheng/mall-swarm/blob/master/document/docker/docker-compose-app.yml")])]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" docker-compose-app.yml up "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("ul",[t("li",[a._v("启动成功后，可以查看API文档信息，访问地址：http://192.168.3.101:8201/doc.html")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/img/mall/mall_swarm_run_05.png",alt:""}})]),a._v(" "),t("h2",{attrs:{id:"运行完成效果展示"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行完成效果展示"}},[a._v("#")]),a._v(" 运行完成效果展示")]),a._v(" "),t("ul",[t("li",[a._v("查看注册中心注册服务信息，访问地址：http://192.168.3.101:8848/nacos/")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/img/mall/mall_swarm_run_01.png",alt:""}})]),a._v(" "),t("ul",[t("li",[a._v("监控中心应用信息，访问地址：http://192.168.3.101:8101")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/img/mall/mall_swarm_run_02.png",alt:""}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/img/mall/mall_swarm_run_03.png",alt:""}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/img/mall/mall_swarm_run_04.png",alt:""}})]),a._v(" "),t("ul",[t("li",[a._v("日志收集系统信息，访问地址：http://192.168.3.101:5601")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/img/mall/mall_swarm_run_06.png",alt:""}})]),a._v(" "),t("h2",{attrs:{id:"可视化管理工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#可视化管理工具"}},[a._v("#")]),a._v(" 可视化管理工具")]),a._v(" "),t("blockquote",[t("p",[a._v("Portainer 是一款轻量级的应用，它提供了图形化界面，用于方便的管理Docker环境，包括单机环境和集群环境，下面我们将用Portainer来管理Docker容器中的应用。")])]),a._v(" "),t("ul",[t("li",[t("p",[a._v("官网地址：https://github.com/portainer/portainer")])]),a._v(" "),t("li",[t("p",[a._v("获取Docker镜像文件：")])])]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull portainer/portainer\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("ul",[t("li",[a._v("使用docker容器运行Portainer：")])]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9000")]),a._v(":9000 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8000")]),a._v(":8000 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" portainer "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--restart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("always "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /var/run/docker.sock:/var/run/docker.sock "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /mydata/portainer/data:/data "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" portainer/portainer\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br")])]),t("ul",[t("li",[a._v("查看Portainer的DashBoard信息，访问地址：http://192.168.3.101:9000")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/img/mall/mall_swarm_linux_01.png",alt:""}})]),a._v(" "),t("ul",[t("li",[a._v("查看所有运行中的容器信息：")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/img/mall/mall_swarm_linux_02.png",alt:""}})]),a._v(" "),t("ul",[t("li",[a._v("查看所有已经下载的Docker镜像：")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/img/mall/mall_swarm_linux_03.png",alt:""}})]),a._v(" "),t("ul",[t("li",[a._v("查看"),t("code",[a._v("mall-portal")]),a._v("应用的统计信息：")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/img/mall/mall_swarm_linux_04.png",alt:""}})]),a._v(" "),t("ul",[t("li",[a._v("查看"),t("code",[a._v("mall-portal")]),a._v("应用的运行过程中打印的日志信息：")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/img/mall/mall_swarm_linux_05.png",alt:""}})]),a._v(" "),t("ul",[t("li",[a._v("进入"),t("code",[a._v("mall-portal")]),a._v("应用的容器内部来操作容器内部系统：")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/img/mall/mall_swarm_linux_06.png",alt:""}})]),a._v(" "),t("h2",{attrs:{id:"公众号"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#公众号"}},[a._v("#")]),a._v(" 公众号")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://macro-oss.oss-cn-shenzhen.aliyuncs.com/mall/banner/qrcode_for_macrozheng_258.jpg",alt:"公众号图片"}})])])}),[],!1,null,null,null);t.default=e.exports}}]);