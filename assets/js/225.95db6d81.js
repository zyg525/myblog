(window.webpackJsonp=window.webpackJsonp||[]).push([[225],{569:function(s,a,n){"use strict";n.r(a);var e=n(4),t=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("学习不走弯路，"),a("a",{attrs:{href:"#%E5%85%AC%E4%BC%97%E5%8F%B7"}},[s._v("关注公众号")]),s._v(" 回复「学习路线」，获取mall项目专属学习路线！")]),s._v(" "),a("h1",{attrs:{id:"nginx如何支持https-手把手教贼简单"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx如何支持https-手把手教贼简单"}},[s._v("#")]),s._v(" Nginx如何支持HTTPS？手把手教贼简单！")]),s._v(" "),a("blockquote",[a("p",[s._v("随着我们网站用户的增多，我们会逐渐意识到HTTPS加密的重要性。在不修改现有代码的情况下，要从HTTP升级到HTTPS，让Nginx支持HTTPS是个很好的选择。今天我们来讲下如何从Nginx入手，从HTTP升级到HTTPS，同时支持静态网站和SpringBoot应用，希望对大家有所帮助！")])]),s._v(" "),a("h2",{attrs:{id:"生成ssl自签名证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成ssl自签名证书"}},[s._v("#")]),s._v(" 生成SSL自签名证书")]),s._v(" "),a("blockquote",[a("p",[s._v("虽然自签名证书浏览器认为并不是安全的，但是学习下SSL证书的生成还是很有必要的！")])]),s._v(" "),a("ul",[a("li",[s._v("首先创建SSL证书私钥，期间需要输入两次用户名和密码，生成文件为"),a("code",[s._v("blog.key")]),s._v("；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("openssl genrsa "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-des3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-out")]),s._v(" blog.key "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("利用私钥生成一个不需要输入密码的密钥文件，生成文件为"),a("code",[s._v("blog_nopass.key")]),s._v("；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("openssl rsa "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-in")]),s._v(" blog.key "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-out")]),s._v(" blog_nopass.key\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("创建SSL证书签名请求文件，生成SSL证书时需要使用到，生成文件为"),a("code",[s._v("blog.csr")]),s._v("；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("openssl req "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-key")]),s._v(" blog.key "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-out")]),s._v(" blog.csr\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("在生成过程中，我们需要输入一些信息，需要注意的是"),a("code",[s._v("Common Name")]),s._v("需要和网站域名一致；")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Enter pass phrase for blog.key:\n-----\nCountry Name (2 letter code) [XX]:CN                                         # 国家代码\nState or Province Name (full name) []:jiangsu                                # 省份\nLocality Name (eg, city) [Default City]:jiangsu                              # 城市\nOrganization Name (eg, company) [Default Company Ltd]:macrozheng             # 机构名称\nOrganizational Unit Name (eg, section) []:dev                                # 单位名称\nCommon Name (eg, your name or your server's hostname) []:blog.macrozheng.com # 网站域名\nEmail Address []:macrozheng@qq.com                                           # 邮箱\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:                                                     # 私钥保护密码,可以不输入直接回车\nAn optional company name []:                                                 # 可选公司名称，可以不输入直接回车\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("ul",[a("li",[s._v("生成SSL证书，有效期为365天，生成文件为"),a("code",[s._v("blog.crt")]),s._v("；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("openssl x509 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-req")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-days")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("365")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-in")]),s._v(" blog.csr "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-signkey")]),s._v(" blog.key "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-out")]),s._v(" blog.crt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("其实最终有用的文件是两个，一个是证书文件"),a("code",[s._v("blog.crt")]),s._v("，另一个是不需要输入密码的证书私钥文件"),a("code",[s._v("blog_nopass.key")]),s._v("。")])]),s._v(" "),a("h2",{attrs:{id:"nginx支持https"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx支持https"}},[s._v("#")]),s._v(" Nginx支持HTTPS")]),s._v(" "),a("blockquote",[a("p",[s._v("SSL证书生成好了，接下来我们就可以配置Nginx来支持HTTPS了！")])]),s._v(" "),a("h3",{attrs:{id:"安装nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装nginx"}},[s._v("#")]),s._v(" 安装Nginx")]),s._v(" "),a("ul",[a("li",[s._v("我们还是使用在Docker容器中安装Nginx的方式，先下载Nginx的Docker镜像；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull nginx:1.10\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("下载完成后先运行一次Nginx，由于之后我们要把宿主机的Nginx配置文件映射到Docker容器中去，运行一次方便我们拷贝默认配置；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /mydata/nginx/html:/usr/share/nginx/html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /mydata/nginx/logs:/var/log/nginx  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" nginx:1.10\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("运行成功后将容器中的Nginx配置目录拷贝到宿主机上去；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" nginx:/etc/nginx /mydata/nginx/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("将宿主机上的"),a("code",[s._v("nginx")]),s._v("目录改名为"),a("code",[s._v("conf")]),s._v("，要不然"),a("code",[s._v("/mydata/nginx/nginx")]),s._v("这个配置文件目录看着有点别扭；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /mydata/nginx/nginx /mydata/nginx/conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("创建的Nginx容器复制完配置后就没用了，停止并删除容器；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" stop nginx\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("使用Docker命令重新启动Nginx服务，需要映射好配置文件，由于我们要支持HTTPS，还需要开放"),a("code",[s._v("443")]),s._v("端口。")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(":443 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /mydata/nginx/html:/usr/share/nginx/html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /mydata/nginx/logs:/var/log/nginx  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /mydata/nginx/conf:/etc/nginx "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" nginx:1.10\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"配置支持https"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置支持https"}},[s._v("#")]),s._v(" 配置支持HTTPS")]),s._v(" "),a("ul",[a("li",[s._v("将我们生成好的SSL证书和私钥拷贝到Nginx的"),a("code",[s._v("html/ssl")]),s._v("目录下；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" blog_nopass.key /mydata/nginx/html/ssl/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" blog.crt /mydata/nginx/html/ssl/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("接下来我们需要给"),a("code",[s._v("blog.macrozheng.com")]),s._v("这个域名添加HTTPS支持，在"),a("code",[s._v("/mydata/nginx/conf/conf.d/")]),s._v("目录下添加Nginx配置文件"),a("code",[s._v("blog.conf")]),s._v("，配置文件内容如下；")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server {\n    listen       80; # 同时支持HTTP\n    listen       443 ssl; # 添加HTTPS支持\n    server_name  blog.macrozheng.com;\n  \n    #SSL配置\n    ssl_certificate      /usr/share/nginx/html/ssl/blog/blog.crt; # 配置证书\n    ssl_certificate_key  /usr/share/nginx/html/ssl/blog/blog_nopass.key; # 配置证书私钥\n    ssl_protocols        TLSv1 TLSv1.1 TLSv1.2; # 配置SSL协议版本\n    ssl_ciphers          ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; # 配置SSL加密算法\n    ssl_prefer_server_ciphers  on; # 优先采取服务器算法\n    ssl_session_cache    shared:SSL:10m; # 配置共享会话缓存大小\n    ssl_session_timeout  10m; # 配置会话超时时间\n\n    location / {\n        root   /usr/share/nginx/html/www;\n        index  index.html index.htm;\n    }\n\n    location /admin {\n        alias   /usr/share/nginx/html/admin;\n        index  index.html index.htm;\n    }\n\n    location /app {\n        alias   /usr/share/nginx/html/app;\n        index  index.html index.htm;\n    }\n\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br")])]),a("ul",[a("li",[s._v("通过"),a("code",[s._v("HTTPS")]),s._v("访问"),a("code",[s._v("blog.macrozheng.com")]),s._v("这个域名，由于我们使用的是自己签名的SSL证书，浏览器会提示"),a("code",[s._v("您的连接不是私密连接")]),s._v("，点击继续前往可以通过HTTPS正常访问；")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/nginx_https_start_01.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("我们可以查看下证书的"),a("code",[s._v("颁发者")]),s._v("信息，可以发现正好是之前我们创建SSL证书签名请求文件时录入的信息；")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/nginx_https_start_02.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("接下来我们需要给"),a("code",[s._v("api.macrozheng.com")]),s._v("这个域名添加HTTPS支持，通过这个域名可以使用HTTPS访问我们的SpringBoot应用，"),a("code",[s._v("api.crt")]),s._v("和"),a("code",[s._v("api_nopass.key")]),s._v("文件需要自行生成，在"),a("code",[s._v("/mydata/nginx/conf/conf.d/")]),s._v("目录下添加Nginx配置文件"),a("code",[s._v("api.conf")]),s._v("，配置文件内容如下；")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server {\n    listen       80; # 同时支持HTTP\n    listen       443 ssl; # 添加HTTPS支持\n    server_name  api.macrozheng.com; #修改域名\n\n    #ssl配置\n    ssl_certificate      /usr/share/nginx/html/ssl/api/api.crt; # 配置证书\n    ssl_certificate_key  /usr/share/nginx/html/ssl/api/api_nopass.key; # 配置证书私钥\n    ssl_protocols        TLSv1 TLSv1.1 TLSv1.2; # 配置SSL协议版本 # 配置SSL加密算法\n    ssl_ciphers          ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;\n    ssl_prefer_server_ciphers  on; # 优先采取服务器算法\n    ssl_session_cache    shared:SSL:10m; # 配置共享会话缓存大小\n    ssl_session_timeout  10m; # 配置会话超时时间\n\n    location / {\n        proxy_pass   http://192.168.3.101:8080; # 设置代理服务访问地址\n        proxy_set_header  Host $http_host; # 设置客户端真实的域名（包括端口号）\n        proxy_set_header  X-Real-IP  $remote_addr; # 设置客户端真实IP\n        proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for; # 设置在多层代理时会包含真实客户端及中间每个代理服务器的IP\n        proxy_set_header X-Forwarded-Proto $scheme; # 设置客户端真实的协议（http还是https）\n        index  index.html index.htm;\n    }\n\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("ul",[a("li",[s._v("通过"),a("code",[s._v("HTTPS")]),s._v("访问"),a("code",[s._v("api.macrozheng.com")]),s._v("这个域名，访问地址为：https://api.macrozheng.com/swagger-ui.html")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/nginx_https_start_03.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("任意调用一个接口测试下，比如说登录接口，可以发现已经可以通过HTTPS正常访问SpringBoot应用提供的接口。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/nginx_https_start_04.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"使用受信任的证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用受信任的证书"}},[s._v("#")]),s._v(" 使用受信任的证书")]),s._v(" "),a("blockquote",[a("p",[s._v("之前我们使用的是自签名的SSL证书，对于浏览器来说是无效的。使用权威机构颁发的SSL证书浏览器才会认为是有效的，这里给大家推荐两种申请免费SSL证书的方法，一种是从阿里云申请，另一种是从FreeSSL申请。")])]),s._v(" "),a("h3",{attrs:{id:"阿里云证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#阿里云证书"}},[s._v("#")]),s._v(" 阿里云证书")]),s._v(" "),a("ul",[a("li",[s._v("阿里云上可以申请的免费证书目前只有支持单个域名的DV级SSL证书。比如说你有"),a("code",[s._v("blog.macrozheng.com")]),s._v("和"),a("code",[s._v("api.macrozheng.com")]),s._v("两个二级域名需要使用HTTPS，就需要申请两个SSL证书。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/nginx_https_start_05.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("申请成功后点击下载Nginx证书即可；")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/nginx_https_start_06.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("下载完成后解压会有下面两个文件；")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("blog.macrozheng.com.key "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 证书私钥文件")]),s._v("\nblog.macrozheng.com.pem "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 证书文件")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("拷贝证书文件到Nginx的指定目录下，然后修改配置文件"),a("code",[s._v("blog.conf")]),s._v("，只要修改证书配置路径即可，修改完成后重启Nginx；")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#SSL配置\nssl_certificate      /usr/share/nginx/html/ssl/blog/blog.macrozheng.com.pem; # 配置证书\nssl_certificate_key  /usr/share/nginx/html/ssl/blog/blog.macrozheng.com.key; # 配置证书私钥\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("再次通过HTTPS访问"),a("code",[s._v("blog.macrozheng.com")]),s._v("这个域名，发现证书已经有效了，连接也是安全的了。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/nginx_https_start_07.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"freessl证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#freessl证书"}},[s._v("#")]),s._v(" FreeSSL证书")]),s._v(" "),a("ul",[a("li",[s._v("如果你有使用通配符域名的需求，可以上"),a("code",[s._v("FreeSSL")]),s._v("申请SSL证书，不过免费的有效期只有3个月，这就意味着你过3个月就要重新申请一次了。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/nginx_https_start_08.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("附上官网地址：https://freessl.cn/")])]),s._v(" "),a("h3",{attrs:{id:"使用acme-sh自动申请证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用acme-sh自动申请证书"}},[s._v("#")]),s._v(" 使用"),a("code",[s._v("acme.sh")]),s._v("自动申请证书")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("acme.sh")]),s._v("脚本实现了"),a("code",[s._v("acme")]),s._v("协议, 可以从"),a("code",[s._v("letsencrypt")]),s._v("生成免费的证书。一般我们申请的证书有效期都是1年，过期就要重新申请了，使用"),a("code",[s._v("acme.sh")]),s._v("脚本可以实现到期自动申请，再也不用担心证书过期了！")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/mall/nginx_https_start_09.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("附上官网地址：https://github.com/acmesh-official/acme.sh")])]),s._v(" "),a("h2",{attrs:{id:"公众号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#公众号"}},[s._v("#")]),s._v(" 公众号")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://macro-oss.oss-cn-shenzhen.aliyuncs.com/mall/banner/qrcode_for_macrozheng_258.jpg",alt:"公众号图片"}})])])}),[],!1,null,null,null);a.default=t.exports}}]);