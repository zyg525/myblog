(window.webpackJsonp=window.webpackJsonp||[]).push([[155],{501:function(a,s,t){"use strict";t.r(s);var r=t(4),e=Object(r.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[a._v("学习不走弯路，"),s("a",{attrs:{href:"#%E5%85%AC%E4%BC%97%E5%8F%B7"}},[a._v("关注公众号")]),a._v(" 回复「学习路线」，获取mall项目专属学习路线！")]),a._v(" "),s("h1",{attrs:{id:"搞定mall项目中的权限管理功能-弄懂这些问题就妥了"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#搞定mall项目中的权限管理功能-弄懂这些问题就妥了"}},[a._v("#")]),a._v(" 搞定Mall项目中的权限管理功能，弄懂这些问题就妥了！")]),a._v(" "),s("blockquote",[s("p",[a._v("最近发现很多朋友问我权限管理功能相关的问题，这里整理了下问的比较多的问题，统一答复下！")])]),a._v(" "),s("h3",{attrs:{id:"mall项目中的权限管理功能是如何实现的"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mall项目中的权限管理功能是如何实现的"}},[a._v("#")]),a._v(" mall项目中的权限管理功能是如何实现的？")]),a._v(" "),s("p",[a._v("之前写过几篇文章，包括了权限管理功能介绍、后端实现和前端实现，看一下基本就清楚了！")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://mp.weixin.qq.com/s/3TNrPNmxHpFTcAhfjnuP0g",target:"_blank",rel:"noopener noreferrer"}},[a._v("《大家心心念念的权限管理功能，这次安排上了！》"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://mp.weixin.qq.com/s/nvKKNSJuIrGuHeJkUeO7rw",target:"_blank",rel:"noopener noreferrer"}},[a._v("《手把手教你搞定权限管理，结合Spring Security实现接口的动态权限控制！》"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://mp.weixin.qq.com/s/UXPeJtx-mIvCPjJW3__c6g",target:"_blank",rel:"noopener noreferrer"}},[a._v("《手把手教你搞定权限管理，结合Vue实现菜单的动态权限控制！》"),s("OutboundLink")],1)])]),a._v(" "),s("h3",{attrs:{id:"ums-permission表还在使用么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ums-permission表还在使用么"}},[a._v("#")]),a._v(" "),s("code",[a._v("ums_permission")]),a._v("表还在使用么？")]),a._v(" "),s("p",[s("code",[a._v("ums_permission")]),a._v("表已经不再使用了，不再使用的表还包括"),s("code",[a._v("ums_admin_permission_relation")]),a._v("和"),s("code",[a._v("ums_role_permission_relation")]),a._v("表，最新版已经移除了相关使用代码。")]),a._v(" "),s("h3",{attrs:{id:"mall项目升级代码后ums-resource表找不到"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mall项目升级代码后ums-resource表找不到"}},[a._v("#")]),a._v(" mall项目升级代码后"),s("code",[a._v("ums_resource")]),a._v("表找不到？")]),a._v(" "),s("p",[a._v("升级代码以后需要同时导入最新版本的SQL脚本，否则会找不到新创建的表，SQL脚本在项目的"),s("code",[a._v("document\\sql")]),a._v("文件夹下面。")]),a._v(" "),s("h3",{attrs:{id:"只实现了管理后台的权限-移动端权限如何处理的"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#只实现了管理后台的权限-移动端权限如何处理的"}},[a._v("#")]),a._v(" 只实现了管理后台的权限，移动端权限如何处理的？")]),a._v(" "),s("p",[a._v("移动端只实现了登录认证，暂时不做权限处理。")]),a._v(" "),s("h3",{attrs:{id:"在管理后台添加了一个菜单-为什么前端没有显示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在管理后台添加了一个菜单-为什么前端没有显示"}},[a._v("#")]),a._v(" 在管理后台添加了一个菜单，为什么前端没有显示？")]),a._v(" "),s("p",[a._v("只有在前端路由中配置了的菜单，在管理后台添加后才会显示，否则没有效果。")]),a._v(" "),s("p",[s("img",{attrs:{src:"/img/mall/mall_permission_question_01.png",alt:""}})]),a._v(" "),s("h3",{attrs:{id:"前端路由中修改了菜单名称-为什么还是原来的名称"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端路由中修改了菜单名称-为什么还是原来的名称"}},[a._v("#")]),a._v(" 前端路由中修改了菜单名称，为什么还是原来的名称？")]),a._v(" "),s("p",[a._v("菜单名称、图标、是否隐藏都是由管理后台配置的，当管理后台配置好后，前端修改是无效的。")]),a._v(" "),s("p",[s("img",{attrs:{src:"/img/mall/mall_permission_question_02.png",alt:""}})]),a._v(" "),s("h3",{attrs:{id:"mall-swarm项目中的权限管理功能是如何实现的"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mall-swarm项目中的权限管理功能是如何实现的"}},[a._v("#")]),a._v(" mall-swarm项目中的权限管理功能是如何实现的？")]),a._v(" "),s("p",[a._v("采用了基于Oauth2的的统一认证鉴权方式，通过认证服务进行统一认证，然后通过网关来统一校验认证和鉴权。具体可以参考："),s("a",{attrs:{href:"https://mp.weixin.qq.com/s/npyZsa4p30PLULxjskxKSA",target:"_blank",rel:"noopener noreferrer"}},[a._v("《微服务权限终极解决方案，Spring Cloud Gateway + Oauth2 实现统一认证和鉴权！》"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"mall和mall-swarm项目中权限管理的实现有何不同"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mall和mall-swarm项目中权限管理的实现有何不同"}},[a._v("#")]),a._v(" mall和mall-swarm项目中权限管理的实现有何不同？")]),a._v(" "),s("p",[a._v("mall项目实现方式是Spring Security，相当于把安全功能封装成了一个工具包"),s("code",[a._v("mall-security")]),a._v("，然后其他模块通过依赖该工具包来实现权限管理，比如"),s("code",[a._v("mall-admin")]),a._v("模块。\nmall-swarm项目实现方式是Oauth2+Gateway，采用的是统一的认证和鉴权，mall-swarm中的其他模块只需关注自己的相关业务，而无需依赖任何安全工具包，更加适合微服务架构。")]),a._v(" "),s("h3",{attrs:{id:"mall-swarm项目对接前端项目时为什么会提示你已经被登出"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mall-swarm项目对接前端项目时为什么会提示你已经被登出"}},[a._v("#")]),a._v(" mall-swarm项目对接前端项目时为什么会提示你已经被登出？")]),a._v(" "),s("p",[a._v("一种情况是前端访问后端接口没有走网关，首先需要修改"),s("code",[a._v("mall-admin-web")]),a._v("项目的后端接口访问基础路径，修改文件为项目"),s("code",[a._v("config")]),a._v("目录下的"),s("code",[a._v("dev.env.js")]),a._v("，将"),s("code",[a._v("BASE_API")]),a._v("改为从网关访问"),s("code",[a._v("mall-admin")]),a._v("服务的路径。")]),a._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'use strict'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" merge "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'webpack-merge'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" prodEnv "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'./prod.env'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("merge")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("prodEnv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("NODE_ENV")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'\"development\"'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("BASE_API")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'\"http://localhost:8201/mall-admin\"'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("p",[a._v("另一种情况是没有更新到最新代码，需要更新到最新代码并导入最新版本的SQL。之前在"),s("code",[a._v("mall-gateway")]),a._v("项目中配置白名单的时候把"),s("code",[a._v("/mall-admin/admin/info")]),a._v("接口配置进去了，会导致无法登录的情况，需要去除掉，目前已经修复了。")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("secure")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ignore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("urls")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#配置白名单路径")]),a._v("\n     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/mall-admin/admin/info"')]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("还有一点需要注意的是由于"),s("code",[a._v("/mall-admin/admin/info")]),a._v("接口配置已经不在白名单中了，所以需要登录的用户需要配置该接口的相应资源，否则会无法登录。")]),a._v(" "),s("p",[s("img",{attrs:{src:"/img/mall/mall_permission_question_03.png",alt:""}})]),a._v(" "),s("h3",{attrs:{id:"mall-swarm项目如何访问需要登录认证的接口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mall-swarm项目如何访问需要登录认证的接口"}},[a._v("#")]),a._v(" mall-swarm项目如何访问需要登录认证的接口？")]),a._v(" "),s("p",[a._v("由于项目中存在两套不同的用户体系，后台用户和前台用户，认证中心对多用户体系也有所支持。如何访问需要登录的接口，先调用认证中心接口获取token，不同体系下的用户需要传入不同的"),s("code",[a._v("client_id")]),a._v("和"),s("code",[a._v("client_secret")]),a._v("，后台用户为"),s("code",[a._v("admin-app:123456")]),a._v("，前台用户为"),s("code",[a._v("portal-app:123456")]),a._v("。")]),a._v(" "),s("p",[s("img",{attrs:{src:"/img/mall/mall_permission_question_04.png",alt:""}})]),a._v(" "),s("p",[a._v("然后将token添加到请求头中，即可访问需要权限的接口了。")]),a._v(" "),s("p",[s("img",{attrs:{src:"/img/mall/mall_permission_question_05.png",alt:""}})]),a._v(" "),s("p",[a._v("当然对原来的登录接口也做了兼容处理，分别会从内部调用认证中心获取Token，依然可以使用。")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("后台用户登录接口：http://localhost:8201/mall-admin/admin/login")])]),a._v(" "),s("li",[s("p",[a._v("前台用户登录接口：http://localhost:8201/mall-portal/sso/login")])])]),a._v(" "),s("h3",{attrs:{id:"只想学习权限管理功能-有没有什么简单的项目可以学习下"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#只想学习权限管理功能-有没有什么简单的项目可以学习下"}},[a._v("#")]),a._v(" 只想学习权限管理功能，有没有什么简单的项目可以学习下？")]),a._v(" "),s("p",[a._v("可以直接学习下"),s("code",[a._v("mall-tiny")]),a._v("项目，"),s("code",[a._v("mall-tiny")]),a._v("是一款基于SpringBoot+MyBatis-Plus的快速开发脚手架，拥有完整的权限管理功能，可对接Vue前端，开箱即用。具体参考"),s("a",{attrs:{href:"https://mp.weixin.qq.com/s/tN3zjoKQxg1U19D4Slih8w",target:"_blank",rel:"noopener noreferrer"}},[a._v("《还在从零开始搭建项目？手撸了款快速开发脚手架！》"),s("OutboundLink")],1)]),a._v(" "),s("h2",{attrs:{id:"公众号"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#公众号"}},[a._v("#")]),a._v(" 公众号")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://macro-oss.oss-cn-shenzhen.aliyuncs.com/mall/banner/qrcode_for_macrozheng_258.jpg",alt:"公众号图片"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);